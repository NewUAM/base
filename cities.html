<!DOCTYPE html>
<html lang="ua">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Артисти на карті України</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <style>
        #map {
            height: 600px;
            width: 100%;
        }
        body {
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>

<h1>Артисти на карті України (<span id="total-artists">0</span>)</h1>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>

<script>
    const csvFileUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQF8E3B7sRWEdfGxrRwQqtNvf4scBZexST0LGUbR7cXss53wcZw6UCZFHA9ChflUcDOJDTL1F1pJ3M8/pub?gid=0&single=true&output=csv';
    const map = L.map('map').setView([48.3794, 31.1656], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
    }).addTo(map);

  const ukraineGeoJsonUrl = 'https://raw.githubusercontent.com/datasets/geo-boundaries-world-110m/master/countries/UKR.geojson';

fetch(ukraineGeoJsonUrl)
    .then(response => response.json())
    .then(geojson => {
        L.geoJSON(geojson, {
            style: {
                color: "#000",
                weight: 2,
                fillColor: "#ffffff",
                fillOpacity: 0.8
            }
        }).addTo(map);
    });

    const coordinates = {
    "івано-франківськ": [48.9226, 24.7103],
    "івано-франківська область": [48.9326, 24.7203],
    "ізмаїл": [45.3514, 28.8405],
    "ізюм": [49.2088, 37.2488],
    "іловайськ": [47.9255, 38.2003],
    "ірпінь": [50.5215, 30.2505],
    "іршава": [48.3197, 23.0456],
    "авдіївка": [48.1391, 37.7499],
    "антрацит": [48.1157, 39.0871],
    "бар": [49.0706, 27.5618],
    "бахмут": [48.5945, 38.0077],
    "бердичів": [49.8946, 28.5962],
    "бердянськ": [46.7746, 36.8043],
    "битків": [48.6197, 24.4885],
    "борислав": [49.2868, 23.4253],
    "бориспіль": [50.3500, 30.9500],
    "борщів": [48.8088, 26.0383],
    "боярка": [50.3148, 30.2986],
    "бровари": [50.5114, 30.7906],
    "буча": [50.5433, 30.2122],
    "біла церква": [49.8019, 30.1153],
    "варва": [50.4828, 32.8547],
    "васильків": [50.1751, 30.3277],
    "вербівка": [48.9871, 32.9723],
    "вишгород": [50.5863, 30.4976],
    "вишневе": [50.3811, 30.3703],
    "вовчанськ": [50.2903, 36.9416],
    "волинська область": [50.7572, 25.3354],
    "вінницька область": [49.2431, 28.4782],
    "вінниця": [49.2331, 28.4682],
    "глухів": [51.6784, 33.9198],
    "гнідинці": [50.7888, 32.8425],
    "горлівка": [48.3103, 38.0023],
    "горішні плавні": [49.0106, 33.6444],
    "дебальцеве": [48.3407, 38.4044],
    "дніпро": [48.4647, 35.0462],
    "дніпропетровська область": [48.4747, 35.0562],
    "добропілля": [48.4571, 37.0944],
    "донецьк": [48.0159, 37.8029],
    "донецька область": [48.0259, 37.8129],
    "дрогобич": [49.3566, 23.5122],
    "дружківка": [48.6208, 37.5286],
    "енергодар": [47.4981, 34.6574],
    "житомир": [50.2547, 28.6587],
    "житомирська область": [50.2647, 28.6687],
    "жмеринка": [49.0346, 28.1176],
    "закарпатська область": [48.6308, 22.2979],
    "запоріжжя": [47.8388, 35.1396],
    "запорізька область": [47.8488, 35.1496],
    "затурці": [50.7167, 25.0500],
    "здолбунів": [50.5205, 26.2421],
    "знам'янка": [48.7114, 32.6697],
    "золотарьово": [48.1528, 23.2411],
    "золотоноша": [49.6688, 32.0417],
    "кадіївка": [48.5730, 38.6434],
    "калуш": [49.0125, 24.3550],
    "кам'янець-подільський": [48.6737, 26.5823],
    "кам'янське": [48.5076, 34.6064],
    "канів": [49.7503, 31.4665],
    "капітанівка": [48.6904, 31.1360],
    "карлівка": [49.4572, 35.1320],
    "київ": [50.4501, 30.5234],
    "київська область": [50.4601, 30.5334],
    "ковель": [51.2150, 24.7087],
    "конотоп": [51.2422, 33.2083],
    "кореньок": [51.5672, 33.4669],
    "костянтинівка": [48.5357, 37.7050],
    "коцюбинське": [50.4890, 30.3644],
    "краматорськ": [48.7361, 37.5712],
    "краснокутськ": [50.0505, 35.1962],
    "кременчук": [49.0675, 33.4211],
    "кривий ріг": [47.9105, 33.3918],
    "крим": [44.9521, 34.1024],
    "кропивницький": [48.5073, 32.2620],
    "куп'янськ": [49.7213, 37.5986],
    "кути": [48.2700, 25.1856],
    "ківшарівка": [49.6448, 37.6223],
    "ланівці": [49.8660, 26.0930],
    "лисичанськ": [48.9023, 38.4400],
    "лубни": [50.0667, 32.9976],
    "луганськ": [48.5740, 39.3078],
    "луганська область": [48.5840, 39.3178],
    "луцьк": [50.7472, 25.3254],
    "львів": [49.8397, 24.0297],
    "львівська область": [49.8497, 24.0397],
    "макіївка": [48.0433, 37.9726],
    "маневичі": [51.2500, 25.5670],
    "маріуполь": [47.0971, 37.5434],
    "мелітополь": [46.8365, 35.3689],
    "мена": [51.5222, 32.2148],
    "миколаїв": [46.9750, 31.9946],
    "миколаївська область": [46.9850, 32.0046],
    "миргород": [49.9643, 33.6123],
    "миропіль": [50.4203, 27.5905],
    "млинів": [50.5117, 25.6068],
    "могилів-подільський": [48.4443, 27.8065],
    "моршин": [49.1519, 23.8735],
    "мостиська": [49.7868, 23.1503],
    "мукачево": [48.4392, 22.7178],
    "надвірна": [48.6336, 24.5697],
    "немирів": [48.9722, 28.8473],
    "нетішин": [50.3384, 26.6453],
    "новгород-сіверський": [51.9876, 33.2659],
    "нововолинськ": [50.7334, 24.1626],
    "новоград-волинський": [50.5927, 27.6161],
    "новодністровськ": [48.5843, 27.4421],
    "новомиргород": [48.7827, 31.6494],
    "новоукраїнка": [48.3086, 31.5281],
    "новояворівськ": [49.9286, 23.5747],
    "обухів": [50.1045, 30.6226],
    "одеса": [46.4825, 30.7233],
        "одеська область": [46.4925, 30.7333],
    "окнянський район": [47.4919, 29.4720],
    "олешки": [46.6265, 32.7250],
    "острог": [50.3386, 26.5267],
    "охтирка": [50.3239, 34.9048],
    "первомайськ": [48.0547, 30.8632],
    "перемишляни": [49.6747, 24.5725],
    "переяслав": [50.0809, 31.4656],
    "пирятин": [50.2553, 32.5246],
    "подільськ": [47.7629, 29.5455],
    "покровськ": [48.2884, 37.1841],
    "полтава": [49.5883, 34.5514],
    "полтавська область": [49.5983, 34.5614],
    "попасна": [48.6446, 38.3807],
    "постолівка": [48.8253, 25.4828],
    "прилуки": [50.6042, 32.3978],
    "пустомити": [49.7253, 23.9225],
    "радивилів": [50.1475, 25.2642],
    "радомишль": [50.5068, 29.2466],
    "ржищів": [49.9734, 31.0571],
    "рівне": [50.6299, 26.2616],
    "рівненська область": [50.6399, 26.2716],
    "ромни": [50.7584, 33.4821],
    "рожище": [50.9250, 25.2747],
    "рокитне": [51.2836, 26.8572],
    "саксагань": [47.9562, 33.4286],
    "самбір": [49.5273, 23.2098],
    "сарни": [51.3474, 26.6075],
    "севастополь": [44.6267, 33.5354],
    "синельникове": [48.3315, 35.5213],
    "слобожанське": [50.2901, 35.9070],
    "сміла": [49.2327, 31.8974],
    "сновськ": [51.8389, 31.9503],
    "сокаль": [50.4871, 24.2883],
    "сокиряни": [48.4568, 27.4293],
    "соледар": [48.6936, 38.1143],
    "стебник": [49.3007, 23.5708],
    "стрий": [49.2664, 23.8602],
    "судак": [44.8606, 34.9862],
    "суми": [50.9177, 34.8098],
    "сумська область": [50.9277, 34.8198],
    "тернопіль": [49.5635, 25.6048],
    "тернопільська область": [49.5735, 25.6148],
    "тиячів": [48.0217, 23.5822],
    "токмак": [47.2664, 35.7255],
    "трускавець": [49.2881, 23.5165],
    "тульчин": [48.6836, 28.8567],
    "ужгород": [48.6308, 22.2979],
    "українка": [50.1579, 30.7491],
    "ульянівка": [48.7612, 30.2308],
    "фастів": [50.0855, 29.9215],
    "харків": [49.9935, 36.2304],
    "харківська область": [50.0035, 36.2404],
    "херсон": [46.6454, 32.6269],
    "херсонська область": [46.6554, 32.6369],
    "хмельницький": [49.4315, 26.9965],
    "хмельницька область": [49.4415, 27.0065],
    "червоноград": [50.3988, 24.2405],
    "черкаси": [49.4544, 32.0698],
    "черкаська область": [49.4644, 32.0798],
    "чернівці": [48.3017, 25.9452],
    "чернівецька область": [48.3117, 25.9552],
    "чернігів": [51.5155, 31.2949],
    "чернігівська область": [51.5255, 31.3049],
    "шепетівка": [50.1964, 27.0776],
    "шостка": [51.8721, 33.4842],
    "яготин": [50.2898, 31.7728],
    "яремче": [48.4639, 24.5662],
    "ярославка": [51.1845, 32.2228]
};

    const locationCounts = {};
    let totalArtists = 0;

    Papa.parse(csvFileUrl, {
        download: true,
        header: false,
        complete: function(results) {
            const data = results.data;

            for (let i = 2; i < data.length; i++) {
                let cityRegion = data[i][28];
                
                if (cityRegion) {
                    cityRegion = normalizeLocation(cityRegion);
                    
if (coordinates[cityRegion]) {
    locationCounts[cityRegion] = (locationCounts[cityRegion] || 0) + 1;
    totalArtists++;
}

if (coordinates[`${cityRegion} область`]) {
    locationCounts[`${cityRegion} область`] = (locationCounts[`${cityRegion} область`] || 0) + 1;
    totalArtists++;
}
                }
            }

            document.getElementById('total-artists').textContent = totalArtists;

            displayMarkers();
        }
    });

    function normalizeLocation(location) {
    let normalized = location
        .toLowerCase()
        .replace(/,.*$/, '')
        .replace(/ область/, '')
        .trim();

    if (coordinates[`${normalized} область`]) {
        return `${normalized} область`;
    }
    return normalized;
}

    function displayMarkers() {
        for (const location in locationCounts) {
            const count = locationCounts[location];
            const [lat, lon] = coordinates[location];

            L.marker([lat, lon])
                .addTo(map)
                .bindPopup(`<strong>${location.charAt(0).toUpperCase() + location.slice(1)}</strong><br>Кількість артистів: ${count}`);
        }
    }
</script>

</body>
</html>
